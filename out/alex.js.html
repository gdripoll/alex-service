<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: alex.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: alex.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* jshint esversion:6 */

var express = require('express'),
    router = express.Router();

/** @module alex */

// -----------------------------------------------------------------------------
// middleware that is specific to this router
router.use(function timeLog(req, res, next) {
    console.log('Time: ', Date.now());
    next();
});

// -----------------------------------------------------------------------------

/**
 * router - Alex default message
 * @memberof alex
 * @function
 * @name root
 */
router.get('/', function(req, res) {
    res.render('alex/index', {
        title: 'Alexandria Server'
    });
});


/**
 * router - About us
 * @memberof alex
 * @function
 * @name about
 */
router.get('/about', function(req, res) {
    res.send({
        'title': 'Alexandria list',
        'apis': {
            '/': 'Wellcome screen',
            '/about': 'An about screen',
            '/list/:path': 'Lists a path',
            '/get/:path': 'downloads a file'
        }
    });
});
router.get('/config', function(req, res) {
    res.send(req.app.get('config'));
});

// -----------------------------------------------------------------------------
// dir management
router.get(['/list/?', '/list/*'], function(req, res) {
    var adir = require('./alex/dir');
    var dir = req.app.get('config').fs.root;
    var path = req.params[0] ? req.params[0] : "";
    var files = adir.getDir(
        dir, path,
        function(files) {
            console.log(':: LIST : ' + req.params[0]);
            res.send(files);
        }
    );
});
router.get('/get/*', function(req, res) {
    var fileClass = require('./alex/file');

    var file = new fileClass(req.app.get('config').fs.root, req.params[0]);
    console.log('[[file]]' + file);
    if (file.exists) {
        if (file.type == 'f') {
            res.sendFile(file.fullpath, function(err) {
                if (err) {
                    console.log('ERROR: ' + err);
                    res.status(err.status).end();
                } else {
                    console.log('Sent:', file.fileName);
                }
            });
        } else {
            res.status(404).send("Not a file.");
        }
    } else {
        res.status(404).send({
            file
        });
    }
});

// -----------------------------------------------------------------------------
// file management
router.get('/ren/:from/:to', function(req, res) {
    var fileClass = require('./alex/file'),
        dir = req.app.get('config').fs.root,
        file = new fileClass(dir, decodeURIComponent(req.params.from));

    file.rename(decodeURIComponent(req.params.to), (f) => {
        res.status(200).send(f);
    });
});
router.get('/touch/:file', function(req, res) {
    var File = require('./alex/file'),
        dir = req.app.get('config').fs.root,
        file = new File(dir, decodeURIComponent(req.params.file));

    file.touch((f) => {
        res.status(200).send(f);
    });
});
router.get('/rm/:file', function(req, res) {
    var fileClass = require('./alex/file'),
        dir = req.app.get('config').fs.root,
        file = new fileClass(dir, decodeURIComponent(req.params.file));

    file.delete((f) => {
        res.status(200).send(f);
    });
});

// -----------------------------------------------------------------------------
// Init
module.exports = router;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-alex.html">alex</a></li></ul><h3>Classes</h3><ul><li><a href="File.html">File</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getDir">getDir</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.2</a> on Wed Oct 12 2016 14:56:43 GMT-0300 (ART)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
